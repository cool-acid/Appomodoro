<!DOCTYPE html>
<html>
    <head>
        <title>Prueba audio html5</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="/js/modernizr-2.0.4.js"></script>
    </head>
    <body>
        <section>
            <audio preload="auto" id="alarma">
                <source src="/sounds/alarm.ogg" type="audio/ogg" />
                <source src="/sounds/alarm.mp3" type="audio/mpeg" />
            </audio>
            <object class="playerpreview" id="flashAudio" type="application/x-shockwave-flash" data="/flash/player.swf" width="1" height="1"> 
                <param name="movie" value="/flash/player.swf" /> 
                <param name="AllowScriptAccess" value="always" /> 
                <param name="FlashVars" value="listener=myListener&amp;interval=500&amp;mp3=/sounds/alarm.mp3" /> 
            </object>
            <div id="botones">
                <a href="#" id="jugar">PLAY</a>
            </div>
        </section>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
        <script>!window.jQuery && document.write(unescape('%3Cscript src="js/jquery-1.6.1.min.js"%3E%3C/script%3E'))</script>
        <script type="text/javascript">
            $(document).ready(function() {
                
                //Cosas del audio
                if(Modernizr.audio){
                    channel_max = 10;
                    audiochannels = new Array();

                    for (a=0;a<channel_max;a++){
                        audiochannels[a] = new Array();
                        audiochannels[a]['channel'] = new Audio();
                        audiochannels[a]['finished'] = -1;
                    }
                }
                function play_multi_sound(s,src)
                {
                    for (a=0;a<audiochannels.length;a++) {
                        thistime = new Date();
                        if (audiochannels[a]['finished'] < thistime.getTime()) {
                            audiochannels[a]['finished'] = thistime.getTime() + document.getElementById(s).duration*1000;
                            //                audiochannels[a]['channel'].src = document.getElementById(s).src;
                            audiochannels[a]['channel'].src = src;
                            audiochannels[a]['channel'].load();
                            audiochannels[a]['channel'].play();
                            break;
                        }
                    }
                }
                
                if(Modernizr.audio)
                {
                    if(Modernizr.audio.ogg){
                        $('body').append("<h1>Hay audio con ogg</h1>");
                    }else if (Modernizr.audio.mp3){
                        $('body').append("<h1>Hay audio con mp3</h1>");
                    }else{
                        //cargar flash y funciones
                        $('body').append("<h1>No soporta ogg ni mp3. Cayendo a flash.</h1>");
                    }
                }else{
                    //cargar funciones
                    $('body').append("<h1>No hay elemento audio. ): Cayendo a flash.</h1>");
                }
                
                var myListener = new Object();
                myListener.onInit = function()
                {
                    this.position = 0;
                };
                myListener.onUpdate = function()
                {
                    pass = ":)";
                }
                function getFlashObject()
                {
                    return document.getElementById("flashAudio");
                }
                function play()
                {
                    console.log("Playing flash");
                    if (myListener.position == 0) {
                        getFlashObject().SetVariable("method:setUrl", "/sounds/alarm.mp3");
                    }
                    getFlashObject().SetVariable("method:play", "");
                    getFlashObject().SetVariable("enabled", "true");
                }
                $('#flash').click(function(){
                    play();
                });
                $('#jugar').click(function()
                {
                    if(Modernizr.audio){
                        if(Modernizr.audio.ogg){
                            play_multi_sound('alarma','/sounds/alarm.ogg');
                        }else if (Modernizr.audio.mp3){
                            play_multi_sound('alarma', '/sounds/alarm.mp3');
                        }else{
                            play();
                        }
                    }else{
                        play();
                    }
                    return false;
                });
            });
        </script>
    </body>
</html>
