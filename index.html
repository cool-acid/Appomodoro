<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>appomodoro</title>
        <script src="/js/jquery-1.6.1.min.js"></script>
        <script src="/js/modernizr-2.0.4.js"></script>
        <script src="/js/pomotimer.js"></script>

        <link rel="stylesheet" href="/css/general.css"/>

        <!--   GOOGLE WEB FONTS     -->
        <link  href="http://fonts.googleapis.com/css?family=Cherry+Cream+Soda:regular&v1" rel="stylesheet">
        <link  href="http://fonts.googleapis.com/css?family=Rock+Salt:regular&v1" rel="stylesheet">
    </head>
    <body>
        <div id="rays">
            <div id="container">
                <header>
                    <h1 class="logo"><span class="tomate"></span>ap<span class="overlay">p</span><span class="resto">omodoro</span></h1>
                </header>
                <section id="wtf">
                    <h1>WTF</h1>
                    <div id="wtfexpand">
                        <p>Appomodoro es un cron&oacute;metro para aplicar la <b>t&eacute;cnica Pomodoro</b>. Si no sabes de que se trata, ve y lee el <a href="http://es.wikipedia.org/wiki/T%C3%A9cnica_Pomodoro" title="Articulo de la Wikipedia acerca de la t&eacute;cnica pomodoro">art&iacute;culo de wikipedia.</a></p>
                        <p>Desarroll&eacute; appomodoro para practicar en mis skills de HTML5 y de App Engine. Si tienes alg&uacute;n comentario o sugerencia, <a href="mailto:coolacid217@gmail.com">escr&iacute;beme un correo.</a></p>
                        <p>Â¡Que disfrutes appomodoro!</p>
                    </div>
                </section>
                <section id="reloj">
                    <canvas width="100" height="180" id="seg0">Miau</canvas>
                    <canvas width="100" height="180" id="seg1">Miau</canvas>
                    <canvas width="60" height="180" id="separador">Miau</canvas>
                    <canvas width="100" height="180" id="seg2">Miau</canvas>
                    <canvas width="100" height="180" id="seg3">Miau</canvas>
                </section>
                <section id="botones">
                    <a href="#" id="start" class="green button super">Iniciar Pomodoro</a>
                    <audio id="alarma" preload="auto">
                        <source src="/sounds/alarm.ogg" type="audio/ogg" />
                        <source src="/sounds/alarm.mp3" type="audio/mpeg" />
                    </audio>
                </section>
                <section id="config">
                    <h1>Configuraciones:</h1>
                    <ul id="configul">
                        <li>
                            <label for="largopom">Duraci&oacute;n del pomodoro:</label>
                            <input type="number" min ="1" max ="99" id="largopom" name="largopom" value="{{preferencias.largopom}}"/>minutos
                        </li>    
                        <li>
                            <label for="descorto">Duraci&oacute;n del descanso normal:</label>
                            <input type="number" min ="1" max ="99" id="descorto" name="descorto" value="{{preferencias.descorto}}"/>minutos
                        </li>    
                        <li>
                            <label for="deslargo">Duraci&oacute;n del descanso largo:</label>
                            <input type="number"  min ="1" max ="99" id="deslargo" name="deslargo" value="{{preferencias.deslargo}}"/>minutos
                        </li>
                    </ul>
                </section>
                <footer>
                    <p>Creado por Cool Acid un d&iacute;a que quer&iacute;a aprender 
                        <a href="http://es.wikipedia.org/wiki/HTML_5" target="_blank">HTML 5</a>
                        y <a href="http://code.google.com/appengine/" target="_blank">App Engine</a> y no ten&iacute;a nada que hacer.</p>
                </footer>
            </div>
        </div>
        <script type="text/javascript">
            $(document).ready(function() {
                var minpomodoro = {{preferencias.largopom}};
                var descorto = {{preferencias.descorto}};
                var deslargo = {{preferencias.deslargo}};
                var wtf = false;
                
                var relojito = new pomotimer(minpomodoro,descorto,deslargo);
                
                //checamos por soporte de canvas
                if (Modernizr.canvas){
                    relojito.inicializar();
                    $('#start').click(function(){
                        relojito.iniciar();
                        return false;
                    });
                }else{
                    alert("Tu navegador no soporta Canvas! D:");
                    //TODO: Manejar esto menos gachamente.
                }
                //checamos por soporte de notifications
                if (window.webkitNotifications) {
                    $('#allowNotifications').live('click',function(){
                        window.webkitNotifications.requestPermission(function(){
                            $('#notifications').html("Notificaciones de escritorio activadas.");
                        });
                        return false;
                    });
//                    $('#denyNotifications').live('click',function(){
                        //Aqui ira como quitar el permiso cuando sepa si hay una funcion que lo haga o siquiera si es posible
//                    });

                    if (window.webkitNotifications.checkPermission() == 0) { // 0 is PERMISSION_ALLOWED
                        $('#configul').prepend("<li id='notifications'>Notificaciones de escritorio activadas.</li>");
                    } else {
                        $('#configul').prepend("<li id='notifications'><a href='#' id='allowNotifications'>Activar notificaciones de escritorio</a></li>");
                    }
                }
                
                $('#formita').submit(function(){return false;});
                $('#configul input').bind("change blur keyup mouseup", function() {
                    id = $(this).attr('id');
                    var minutos = $(this).val();
                    var numero = new RegExp("^[0-9]{1,2}$");
                    if (numero.test(minutos)){
                        $(this).attr("style","color:#FFF;");
                        switch(id){
                            case 'largopom':
                                relojito.minpomodoro = minutos;
                                if (!relojito.encendido){
                                    relojito.inicializar();
                                }
                                break;
                            case 'descorto':
                                relojito.shortrest = minutos;
                                break;
                            case 'deslargo':
                                relojito.longrest = minutos;
                                break;
                        }
                    }else{
                        $(this).attr("style","color:#F55;");
                    }
                });
                $('#wtf').click(function(){
                    if(!wtf){
                        $('#wtf>h1').animate({fontSize: "2em"},500);
                        $('#wtf').animate({width: 500},500,function(){
                            $('#wtf').animate({height: 200},500,function(){
                                $('#wtfexpand').fadeIn('fast');
                            });
                        });
                    }else{
                        $('#wtfexpand').fadeOut('fast',function(){
                            $('#wtf').animate({height: 40},500,function(){
                                $('#wtf>h1').animate({fontSize: ".8em"},500);
                                $('#wtf').animate({width: 40},500);
                            });
                        });
                    }
                    wtf = !wtf;
                });
            });
        </script>
    </body>
</html>