<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>:: appomodoro ::</title>
        <script src="/js/jquery-1.6.1.min.js"></script>
        <script src="/js/modernizr-2.0.4.js"></script>
        
        <link rel="stylesheet" href="/css/general.css"/>
        
        <!--   GOOGLE WEB FONTS     -->
        <link  href="http://fonts.googleapis.com/css?family=Cherry+Cream+Soda:regular&v1" rel="stylesheet">
        <link  href="http://fonts.googleapis.com/css?family=Rock+Salt:regular&v1" rel="stylesheet">
    </head>
    <body>
        <div id="rays">
            <div id="container">
                <header>
                    <h1 class="logo"><span class="tomate"></span>ap<span class="overlay">p</span><span class="resto">omodoro</span></h1>
                </header>
                <section id="wtf">
                    <h1>Wtf?</h1>
                    <div id="wtfexpand">
                        <p>Appomodoro es un cron&oacute;metro para aplicar la <b>t&eacute;cnica Pomodoro</b>. Si no sabes de que se trata, ve y lee el <a href="http://es.wikipedia.org/wiki/T%C3%A9cnica_Pomodoro" title="Articulo de la Wikipedia acerca de la t&eacute;cnica pomodoro">art&iacute;culo de wikipedia.</a></p>
                        <p>Desarroll&eacute; appomodoro para practicar en mis skills de HTML5 y de App Engine. Si tienes alg&uacute;n comentario o sugerencia, <a href="mailto:coolacid217@gmail.com">escr&iacute;beme un correo.</a></p>
                        <p>¡Que disfrutes appomodoro!</p>
                    </div>
                </section>
                <section id="reloj">
                    <canvas width="100" height="180" id="seg0">Miau</canvas>
                    <canvas width="100" height="180" id="seg1">Miau</canvas>
                    <canvas width="60" height="180" id="separador">Miau</canvas>
                    <canvas width="100" height="180" id="seg2">Miau</canvas>
                    <canvas width="100" height="180" id="seg3">Miau</canvas>
                </section>
                <section id="botones">
                    <a href="#" id="start" class="red button super">Iniciar Contador</a>
                </section>
                <section id="config">
                    <h1>Configuraciones:</h1>
                    <ul id="configul">
                        <li>
                            <label for="largopom">Duraci&oacute;n del pomodoro:</label>
                            <input type="text" id="largopom" name="largopom" value="{{preferencias.largopom}}"/>minutos
                        </li>    
                        <li>
                            <label for="descorto">Duraci&oacute;n del descanso normal:</label>
                            <input type="text" id="descorto" name="descorto" value="{{preferencias.descorto}}"/>minutos
                        </li>    
                        <li>
                            <label for="deslargo">Duraci&oacute;n del descanso largo:</label>
                            <input type="text" id="deslargo" name="deslargo" value="{{preferencias.deslargo}}"/>minutos
                        </li>
                    </ul>
                </section>
                <footer>
                    <p>Creado por Cool Acid un dia que queria aprender HTML5 y no tenia nada que hacer en el año 2011</p>
                </footer>
            </div>
        </div>
        <script type="text/javascript">
            var segpomodoro;
            function dibujasegmento(contexto, color){
                if (color == null){
                    color = '#000'
                }
                contexto.beginPath();
                contexto.moveTo(0,10);
                contexto.lineTo(10,0);
                contexto.lineTo(70,0);
                contexto.lineTo(80,10);
                contexto.lineTo(70,20);
                contexto.lineTo(10,20);
                contexto.lineTo(0,10);
                contexto.fillStyle = color;
                contexto.fill();
            }
            function dibujanumero(valor, donde){
                //Configuracion: colores.
                var coloron = '#FFF';
                var coloroff = '#3A3A3A';
                //BCD
                var deco = [[1,1,1,1,1,1,0],
                    [0,1,1,0,0,0,0],
                    [1,1,0,1,1,0,1],
                    [1,1,1,1,0,0,1],
                    [0,1,1,0,0,1,1],
                    [1,0,1,1,0,1,1],
                    [1,0,1,1,1,1,1],
                    [1,1,1,0,0,0,0],
                    [1,1,1,1,1,1,1],
                    [1,1,1,0,0,1,1],
                    [1,1,1,1,1,1,0]];
                var numero = deco[valor];
                var aidi = 'seg'+donde;
                var canvas = document.getElementById(aidi);
                canvas.width = canvas.width;
                var caco = canvas.getContext("2d");
            
                //Ahora a dibujar el display de 7 segmentos:
            
                //Segmento A:
                caco.translate(10,0);
                color = (numero[0]==1)?coloron:coloroff;
                dibujasegmento(caco,color);
            
                //Segmento B:
                caco.translate(91,11);
                caco.rotate(Math.PI/2);    
                color = (numero[1]==1)?coloron:coloroff;
                dibujasegmento(caco,color);
            
                //Segmento C:
                caco.translate(81,0);
                color = (numero[2]==1)?coloron:coloroff;
                dibujasegmento(caco,color);
            
                //Segmento D:
                caco.translate(91,11);
                caco.rotate(Math.PI/2);    
                color = (numero[3]==1)?coloron:coloroff;
                dibujasegmento(caco,color);
            
                //Segmento E:
                caco.translate(91,11);
                caco.rotate(Math.PI/2);    
                color = (numero[4]==1)?coloron:coloroff;
                dibujasegmento(caco,color);
            
                //Segmento F:
                caco.translate(81,0);
                color = (numero[5]==1)?coloron:coloroff;
                dibujasegmento(caco,color);
            
                //Segmento G:
                caco.translate(10,11);
                caco.rotate(Math.PI/2);    
                color = (numero[6]==1)?coloron:coloroff;
                dibujasegmento(caco,color);

            }
            function dospuntos(contexto, color){
                if (color == null){
                    color = '#000'
                }
                contexto.beginPath();
                contexto.arc(30,60,15,0,Math.PI*2,true);
                contexto.arc(30,150,15,0,Math.PI*2,true);
                contexto.fillStyle = color;
                contexto.fill();
            }     
            function f5reloj(){
                min1 = Math.floor(segpomodoro/600);
                min2 = Math.floor(segpomodoro/60)- min1*10;
            
                sec1 = Math.floor((segpomodoro%60)/10);
                sec2 = segpomodoro%60 - sec1*10;
            
                dibujanumero(min1,0);
                dibujanumero(min2,1);
                dibujanumero(sec1,2);
                dibujanumero(sec2,3);
            }
            function pomodoro(){
                segpomodoro-=1;
                if(segpomodoro == 0){
                    //alarma!!
                    alert('Se acabó!');
                    f5reloj();
                }else{
                    minutos = Math.floor(segpomodoro/60);
                    segundos = segpomodoro%60;
                    $('#contador').val(minutos+":"+segundos);
                    f5reloj();
                    t=setTimeout("pomodoro()",1000);
                }
            }
            $(document).ready(function() {
                var minpomodoro = 25;
                var mindescanso = 5;
                $('#contador').val(minpomodoro+":00");
                segpomodoro = minpomodoro * 60;
                f5reloj();
                pomodoro();
            
                $('#formita').submit(function(){return false;});
                if (Modernizr.canvas){
                
                    for(i=0;i<4;i++){
                        dibujanumero(8,i);
                    }
                    puntos = document.getElementById('separador').getContext("2d");
                    dospuntos(puntos,'#FFF');
                
                    $('#rango').change(function(){
                        dibujanumero($(this).val(),0);
                        dibujanumero($(this).val(),1);
                        dibujanumero($(this).val(),2);
                        dibujanumero($(this).val(),3);
                    });
                }else{
                    alert("Tu navegador no soporta Canvas! D:");
                }
            });
        </script>
    </body>
</html>